// require('dotenv').config()
// or just run the node script like this:
// export GOOGLE_APPLICATION_CREDENTIALS="/Users/dave/CODE/membox-v7/secrets/membox-v7-9c068c27c947-gcp-key.json"
// node make-audio-files-from-google.js

const textToSpeech = require('@google-cloud/text-to-speech')
const fs = require('fs')
const util = require('util')

const TEST_LIST = ['aku', 'kamu', 'yang', 'tidak', 'ini', 'itu', 'dan']

const FULL_LIST = [
  'aku',
  'kamu',
  'yang',
  'tidak',
  'ini',
  'itu',
  'dan',
  'di',
  'dia',
  'akan',
  'apa',
  'kita',
  'untuk',
  'anda',
  'bisa',
  'ada',
  'mereka',
  'saya',
  'tahu',
  'dengan',
  'dari',
  'ya',
  'kami',
  'tapi',
  'ke',
  'harus',
  'sudah',
  'adalah',
  'orang',
  'saja',
  'ingin',
  'seperti',
  'pergi',
  'jika',
  'hanya',
  'sini',
  'sekarang',
  'semua',
  'dalam',
  'jadi',
  'baik',
  'bukan',
  'jangan',
  'bagaimana',
  'punya',
  'lagi',
  'lebih',
  'pada',
  'mungkin',
  'melakukan',
  'kalian',
  'sangat',
  'karena',
  'satu',
  'pernah',
  'mau',
  'telah',
  'ayo',
  'siapa',
  'juga',
  'hal',
  'kembali',
  'datang',
  'atau',
  'hari',
  'sesuatu',
  'kasih',
  'melihat',
  'banyak',
  'saat',
  'benar',
  'terima kasih',
  'begitu',
  'tentang',
  'terjadi',
  'bahwa',
  'menjadi',
  'kenapa',
  'seorang',
  'bagus',
  'bilang',
  'masih',
  'oke',
  'sana',
  'kalau',
  'keluar',
  'mana',
  'lain',
  'waktu',
  'malam',
  'tempat',
  'mati',
  'lalu',
  'maaf',
  'dapat',
  'membuat',
  'memiliki',
  'anak',
  'tahun',
  'sedang',
  'sampai',
  'mengapa',
  'beberapa',
  'sekali',
  'baru',
  'mengatakan',
  'sendiri',
  'sebuah',
  'ayah',
  'menunggu',
  'hidup',
  'memerlukan',
  'ketika',
  'salah',
  'cepat',
  'sama',
  'besar',
  'masuk',
  'semuanya',
  'mendengar',
  'rumah',
  'pikir',
  'dua',
  'tuhan',
  'masalah',
  'selamat',
  'tentu',
  'pasti',
  'belum',
  'bapak',
  'berbicara',
  'suka',
  'cukup',
  'selalu',
  'pria',
  'seseorang',
  'mengerti',
  'sedikit',
  'ibu',
  'berada',
  'atas',
  'setelah',
  'menolong',
  'tinggal',
  'sayang',
  'menemukan',
  'bahkan',
  'percaya',
  'jalan',
  'bertemu',
  'bekerja',
  'lama',
  'terlalu',
  'makan',
  'wanita',
  'mari',
  'kecil',
  'kali',
  'tetap',
  'setiap',
  'sebagai',
  'oleh',
  'berhenti',
  'yakin',
  'membunuh',
  'luar',
  'mengambil',
  'cara',
  'dunia',
  'mulai',
  'pertama',
  'selama',
  'sebelum',
  'uang',
  'bersama',
  'teman',
  'boleh',
  'senang',
  'merasa',
  'mencari',
  'gadis',
  'membutuhkan',
  'jam',
  'mencoba',
  'tanpa',
  'dulu',
  'polisi',
  'buruk',
  'sebenarnya',
  'para',
  'berapa',
  'membawa',
  'kemudian',
  'siap',
  'ingat',
  'sial',
  'membiarkan',
  'mobil',
  'takkan',
  'tuan',
  'tidur',
  'gila',
  'maksud',
  'kepada',
  'terus',
  'pulang',
  'segera',
  'kota',
  'sakit',
  'nama',
  'halo',
  'takut',
  'pun',
  'sialan',
  'seharusnya',
  'memang',
  'terakhir',
  'biasa',
  'tiga',
  'membantu',
  'terlihat',
  'depan',
  'cinta',
  'sebentar',
  'minta',
  'bodoh',
  'bagian',
  'manusia',
  'bawah',
  'berhasil',
  'tepat',
  'memberi',
  'rasa',
  'air',
  'sepertinya',
  'pagi',
  'sungguh',
  'hebat',
  'bagi',
  'tangan',
  'pekerjaan',
  'kehilangan',
  'mengikuti',
  'keluarga',
  'cuma',
  'nanti',
  'suatu',
  'tua',
  'bergerak',
  'paling',
  'tenang',
  'jauh',
  'masa',
  'menit',
  'meninggalkan',
  'terbaik',
  'peduli',
  'penting',
  'aneh',
  'seluruh',
  'menghentikan',
  'selesai',
  'tadi',
  'duduk',
  'kedua',
  'bulan',
  'senjata',
  'besok',
  'khawatir',
  'kepala',
  'minum',
  'berarti',
  'secara',
  'pintu',
  'hampir',
  'sekolah',
  'berjalan',
  'diam',
  'sebelumnya',
  'aman',
  'sekitar',
  'buat',
  'kemari',
  'sejak',
  'nah',
  'maka',
  'bermain',
  'menggunakan',
  'astaga',
  'cari',
  'sulit',
  'dekat',
  'jatuh',
  'kapan',
  'memberitahu',
  'kesempatan',
  'cantik',
  'benarkah',
  'mudah',
  'kawan',
  'mendapatkan',
  'menarik',
  'soal',
  'mata',
  'berakhir',
  'nya',
  'hati',
  'jelas',
  'akhirnya',
  'minggu',
  'tim',
  'indah',
  'alasan',
  'bangun',
  'keras',
  'serius',
  'berubah',
  'menyenangkan',
  'kosong',
  'belakang',
  'dokter',
  'agar',
  'kuat',
  'lari',
  'mendengarkan',
  'kamar',
  'kata',
  'Amerika',
  'berharap',
  'bertanya',
  'bajingan',
  'berbeda',
  'hilang',
  'darah',
  'makanan',
  'menurut',
  'perang',
  'bantuan',
  'raja',
  'demi',
  'kabar',
  'telepon',
  'kehidupan',
  'buku',
  'meninggal',
  'ruang',
  'daripada',
  'turun',
  'lima',
  'kaki',
  'menyelamatkan',
  'melepaskan',
  'menuju',
  'kapal',
  'pertanyaan',
  'suara',
  'anjing',
  'naik',
  'dasar',
  'muda',
  'permisi',
  'perjalanan',
  'kasus',
  'tinggi',
  'lupa',
  'marah',
  'menikah',
  'lewat',
  'ide',
  'rencana',
  'belajar',
  'silakan',
  'penuh',
  'lucu',
  'negara',
  'berusaha',
  'berdiri',
  'cerita',
  'kecuali',
  'tanah',
  'kekuatan',
  'buka',
  'langsung',
  'menang',
  'antara',
  'membicarakan',
  'menunjukkan',
  'bila',
  'kematian',
  'pesawat',
  'Nona',
  'melalui',
  'sendirian',
  'melawan',
  'akhir',
  'menerima',
  'rahasia',
  'nomor',
  'sepanjang',
  'terlambat',
  'api',
  'pesta',
  'memahami',
  'artinya',
  'brengsek',
  'empat',
  'kira',
  'pilihan',
  'rasanya',
  'sementara',
  'panas',
  'memilih',
  'semakin',
  'mulia',
  'omong',
  'film',
  'tiba',
  'menembak',
  'bung',
  'memakai',
  'tampak',
  'segalanya',
  'membayar',
  'penjara',
  'kesalahan',
  'sempurna',
  'menahan',
  'pesan',
  'perusahaan',
  'bercanda',
  'bayi',
  'bahagia',
  'nyata',
  'mengenal',
  'menjawab',
  'tutup',
  'bahasa',
  'semoga',
  'keren',
  'bertahan',
  'muncul',
  'kantor',
  'terbang',
  'surat',
  'mundur',
  'mesin',
  'janji',
  'beruntung',
  'permainan',
  'perintah',
  'bumi',
  'sebaiknya',
  'gue',
  'dingin',
  'setuju',
  'awal',
  'menjaga',
  'putri',
  'perempuan',
  'guru',
  'mengulangi',
  'berikutnya',
  'namun',
  'tampaknya',
  'setidaknya',
  'semacam',
  'sering',
  'bisnis',
  'membeli',
  'menghancurkan',
  'segala',
  'tanda',
  'kelas',
  'barang',
  'membaca',
  'berita',
  'sehingga',
  'laut',
  'kurang',
  'jahat',
  'menangkap',
  'setengah',
  'menelepon',
  'pikiran',
  'mencuri',
  'menulis',
  'berbahaya',
  'mimpi',
  'tugas',
  'benda',
  'sang',
  'siang',
  'tersebut',
  'meskipun',
  'hukum',
  'berani',
  'istri',
  'saudara',
  'hitam',
  'menangis',
  'terluka',
  'manis',
  'kunci',
  'hubungan',
  'sebelah',
  'juta',
  'agak',
  'mengenai',
  'musim',
  'tubuh',
  'Inggris',
  'kereta',
  'enam',
  'sebabnya',
  'berbohong',
  'udara',
  'menyesal',
  'mengirim',
  'mengerikan',
  'putih',
  'melindungi',
  'sisi',
  'hadiah',
  'arah',
  'merah',
  'memikirkan',
  'informasi',
  'lantai',
  'berat',
  'terhadap',
  'pindah',
  'bebas',
  'membenci',
  'presiden',
  'enak',
  'betapa',
  'kemarin',
  'nyonya',
  'pribadi',
  'wajah',
  'selamanya',
  'obat',
  'bersalah',
  'memutuskan',
  'melewati',
  'saling',
  'lagu',
  'menghilang',
  'bergabung',
  'paman',
  'sistem',
  'menghabiskan',
  'memanggil',
  'kartu',
  'mengubah',
  'mampu',
  'membuka',
  'begini',
  'pintar',
  'hingga',
  'selain',
  'lu',
  'milik',
  'kanan',
  'mengalami',
  'musik',
  'jenis',
  'berjanji',
  'toko',
  'keadaan',
  'entah',
  'menyerang',
  'keamanan',
  'memeriksa',
  'menyerah',
  'sibuk',
  'panjang',
  'bos',
  'batu',
  'pernikahan',
  'pakaian',
  'gagal',
  'detik',
  'tertawa',
  'tentara',
  'jujur',
  'tengah',
  'sadar',
  'mandi',
  'biasanya',
  'matahari',
  'kiri',
  'foto',
  'petugas',
  'burung',
  'anggota',
  'bintang',
  'akal',
  'ruangan',
  'kecelakaan',
  'hutan',
  'memukul',
  'makhluk',
  'seberapa',
  'posisi',
  'panggilan',
  'nenek',
  'khusus',
  'terbuka',
  'mohon; tolong; silakan',
  'perasaan',
  'acara',
  'utama',
  'tertarik',
  'kamera',
  'cahaya',
  'menonton',
  'tujuan',
  'gak',
  'catatan',
  'menggambar',
  'mabuk',
  'utara',
  'kotak',
  'cocok',
  'kabur',
  'kalah',
  'kini',
  'perhatian',
  'kuda',
  'menyelesaikan',
  'menjual',
  'kakak',
  'selanjutnya',
  'operasi',
  'masalahnya',
  'situasi',
  'dewa',
  'hak',
  'sejauh',
  'daging',
  'kejahatan',
  'bank',
  'kulit',
  'es',
  'merupakan',
  'hantu',
  'ternyata',
  'terlibat',
  'kopi',
  'penjaga',
  'ahli',
  'melarikan',
  'gelap',
  'sampah',
  'bau',
  'emas',
  'mengganggu',
  'mengangkat',
  'berguna',
  'pantas',
  'ketakutan',
  'menceritakan',
  'alam',
  'menyadari',
  'pacar',
  'bersumpah',
  'istirahat',
  'prajurit',
  'gedung',
  'pemerintah',
  'pusat',
  'daerah',
  'bernama',
  'kaya',
  'pohon',
  'alat',
  'menempatkan',
  'daftar',
  'laporan',
  'meja',
  'kemungkinan',
  'lapar',
  'hotel',
  'nyaman',
  'menghubungi',
  'minuman',
  'selatan',
  'pertemuan',
  'bahaya',
  'kejadian',
  'maju',
  'asing',
  'binatang',
  'sobat',
  'rambut',
  'ikan',
  'menutup',
  'layak',
  'sebagian',
  'sejarah',
  'balik',
  'sepatu',
  'kebenaran',
  'rusak',
  'berasal',
  'menjelaskan',
  'berangkat',
  'otak',
  'bercinta',
  'normal',
  'urusan',
  'bangga',
  'tumbuh',
  'mengalahkan',
  'luka',
  'sesuai',
  'harapan',
  'jiwa',
  'lahir',
  'memastikan',
  'tujuh',
  'lubang',
  'keputusan',
  'lelah',
  'pengacara',
  'kerajaan',
  'kelihatannya',
  'berhubungan',
  'suami',
  'terkenal',
  'ampun',
  'ratu',
  'kelihatan',
  'bermaksud',
  'dewasa',
  'bunga',
  'malu',
  'kilometer',
  'mengeluarkan',
  'tersisa',
  'tewas',
  'pedang',
  'jawaban',
  'membangun',
  'kedengarannya',
  'aturan',
  'kacau',
  'sepuluh',
  'truk',
  'langkah',
  'satunya',
  'awas',
  'baju',
  'berharga',
  'hasil',
  'hewan',
  'hancur',
  'sungai',
  'latihan',
  'titik',
  'bertarung',
  'menyimpan',
  'berteriak',
  'jendela',
  'mencapai',
  'tindakan',
  'Jepang',
  'mulut',
  'lemah',
  'tamu',
  'semalam',
  'bahan',
  'mengejar',
  'memegang',
  'situ',
  'macam',
  'sederhana',
  'kotoran',
  'adil',
  'menari',
  'seks',
  'menemui',
  'menolak',
  'bertindak',
  'komputer',
  'memotong',
  'kode',
  'habis',
  'lampu',
  'pertandingan',
  'ketiga',
  'pangeran',
  'Belanda',
  'militer',
  'radio',
  'terserah',
  'bersih',
  'merusak',
  'kesepakatan',
  'palsu',
  'tas',
  'berbuat',
  'harga',
  'angin',
  'menikmati',
  'maksudnya',
  'putus',
  'kotor',
  'memperhatikan',
  'bersembunyi',
  'pemimpin',
  'pengadilan',
  'seekor',
  'pantai',
  'biru',
  'tingkat',
  'pulau',
  'konyol',
  'negeri',
  'ih',
  'hujan',
  'kue',
  'menghadapi',
  'lokasi',
  'dinding',
  'timur',
  'membayangkan',
  'gunung',
  'terjebak',
  'termasuk',
  'kisah',
  'perubahan',
  'menyentuh',
  'cepatlah',
  'berjuang',
  'menderita',
  'kursi',
  'pisau',
  'meletakkan',
  'langit',
  'bar',
  'mirip',
  'kucing',
  'seminggu',
  'menjalankan',
  'jantung',
  'warna',
  'barat',
  'kehormatan',
  'warga',
  'kelompok',
  'jumlah',
  'sedih',
  'gigi',
  'Rusia',
  'menyedihkan',
  'garis',
  'pihak',
  'menangani',
  'ayam',
  'terbakar',
  'menyebabkan',
  'asli',
  'memimpin',
  'tukang',
  'umum',
  'jari',
  'menyakiti',
  'sehat',
  'melanjutkan',
  'mesjid',
  'menakjubkan',
  'surga',
  'tidak usah',
  'sisa',
  'delapan',
  'persis',
  'menciptakan',
  'mengatur',
  'tulang',
  'gereja',
  'penyakit',
  'pemain',
  'pertempuran',
  'petunjuk',
  'lelaki',
  'bir',
  'membersihkan',
  'listrik',
  'pasangan',
  'ketua',
  'santai',
  'jelek',
  'darurat',
  'menjauh',
  'membuang',
  'kejutan',
  'ribu',
  'supaya',
  'bentuk',
  'desa',
  'babi',
  'kebanyakan',
  'celana',
  'suruh',
  'halaman',
  'betul',
  'kencan',
  'stasiun',
  'melepaskan',
  'rendah',
  'adik',
  'melompat',
  'mengurus',
  'kakek',
  'kena',
  'menakutki',
  'jalur',
  'klub',
  'tikus',
  'taman',
  'lepas',
  'sore',
  'memperbaiki',
  'teh',
  'tes',
  'tampan',
  'wah',
  'kemampuan',
  'buah',
  'fokus',
  'lelucon',
  'mengucapkan',
  'kondisi',
  'wilayah',
  'lapangan',
  'mantan',
  'grill; to burn; barbecued',
  'tergantung',
  'bersiap',
  'masyarakat',
  'guna',
  'menyebutkan',
  'seni',
  'terkejut',
  'penerbangan',
  'nyawa',
  'berdoa',
  'anggur',
  'permintaan',
  'terkadang',
  'seksi',
  'bibi',
  'sumber',
  'tangga',
  'tanggal',
  'kesulitan',
  'suci',
  'kasar',
  'pencuri',
  'walaupun',
  'mencium',
  'biaya',
  'kebetulan',
  'sejati',
  'sinyal',
  'menghargai',
  'program',
  'menyembunyikan',
  'perahu',
  'parah',
  'gerbang',
  'sihir',
  'tiket',
  'menganggap',
  'puluh',
  'pertunjukan',
  'narkoba',
  'membuktikan',
  'hijau',
  'jarak',
  'malah',
  'semangat',
  'melanggar',
  'badai',
  'cerdas',
  'kertas',
  'hormat',
  'energi',
  'bersikap',
  'isi',
  'tekanan',
  'memalukan',
  'sudut',
  'Perancis',
  'putra',
  'data',
  'bocah',
  'mengagumkan',
  'mustahil',
  'kejam',
  'roti',
  'terutama',
  'istimewa',
  'mahal',
  'menjatuhkan',
  'kecepatan',
  'pelajaran',
  'cincin',
  'mengemudikan',
  'lengkap',
  'pertarungan',
  'sayangnya',
  'dikenal',
  'tertangkap',
  'hakim',
  'menyebalkan',
  'bangunan',
  'mengawasi',
  'sengaja',
  'Cina',
  'ponsel',
  'istana',
  'mematikan',
  'keberuntungan',
  'daya',
  'kebakaran',
  'sepenuhnya',
  'menanyakan',
  'kendali',
  'kenyataan',
  'sebanyak',
  'restoran',
  'pekan',
  'hamil',
  'pasien',
  'roh',
  'kegelapan',
  'taruh'
]

const doesFileExist = (filename) => {
  try {
    if (fs.existsSync(filename)) {
      return true
    } else {
      return false
    }
  } catch (err) {
    console.error(err)
  }
}

function sleep(ms) {
  // this sleep doesn't really work - need to look into it further
  return new Promise((resolve) => setTimeout(resolve, ms))
}

const client = new textToSpeech.TextToSpeechClient()

async function makeRequest(text, voice) {
  const request = {
    input: { text: text },
    voice: {
      languageCode: 'id-ID',
      name: `id-ID-Wavenet-${voice}` // Indonesian has A,B,C,D in Wavenet.  Wavenet is better than Standard
      // ssmlGender: "NEUTRAL",
    },
    audioConfig: {
      audioEncoding: 'MP3'
      // check API docs for other options, like speed, pitch, sampleRate
    }
  }

  const filename = `audio/${voice}/${text}.mp3`

  if (!doesFileExist(filename)) {
    // Performs the text-to-speech request
    const [response] = await client.synthesizeSpeech(request)
    // Write the binary audio content to a local file
    const writeFile = util.promisify(fs.writeFile)
    await writeFile(filename, response.audioContent, 'binary')
    console.log(`Audio content written to file: ${filename}`)
  } else {
    console.log(`File exists, skipping: ${filename}`)
  }
}

// Uncomment this to do it.
function doIt() {
  FULL_LIST.forEach(async (text) => {
    // this sleep doesn't really work - need to look into it further
    await sleep(10000)
    await makeRequest(text, 'A')
    await sleep(10000)
    await makeRequest(text, 'B')
    await sleep(10000)
    await makeRequest(text, 'C')
    await sleep(10000)
    await makeRequest(text, 'D')
  })
}

// function doIt() {
//   FULL_LIST.forEach(async (text) => {
//     makeRequest(text, 'A')
//     makeRequest(text, 'B')
//     makeRequest(text, 'C')
//     makeRequest(text, 'D')
//   })
// }

// Do it?
doIt()
